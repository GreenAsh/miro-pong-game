<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="https://realtimeboard.com/app/static/rtb.uikit.css">
	<script src="https://realtimeboard.com/app/static/rtb.sdk.1.0.js"></script>

	<style>
		.rtb-sidebar-caption {
			font-size: 14px;
			font-weight: bold;
			color: rgba(0, 0, 0, 0.8);
			padding: 24px 0 0 24px;
		}

		.actions {
			padding: 20px 24px 0 24px;
		}

		button {
			height: 32px;
			border-radius: 4px;
			font-size: 12px;
			font-weight: bold;
			line-height: 30px;
			text-align: center;
			color: #fff;
			min-width: 65px;
			background-color: #2a79ff;
			overflow: hidden;
			text-overflow: ellipsis;
		}
	</style>
	<script src="global.js"></script>
	<script src="mapData.js"></script>
	<script src="engineAndMap.js"></script>
	<script src="setup.js"></script>
	<script src="input.js"></script>
</head>

<body>
	<div class="rtb-sidebar-caption">Ping-pong</div>
	<div class="actions">
		<center>
			<br><br>
			<button onclick="run()" style="width: 120px;">Play!</button>
			<button onclick="join()" style="width: 120px;">Join!</button>
			<br><br>
			<h2 id="controls" style="display:none;">Use up/down arrows and A/Z keys to control pad</h2>
			<h2 id="you-are-dead" style="display:none; background-color: red;">You are dead, reopen sidebar and click 'Play'!</h2>
			<h2 id="click-for-focus" style="display:none;">Click on sidebar <br>to control pad</h2>
		</center>
	</div>
	<script>
		'use strict'

		var direction = {x : -1, y: -1};
		async function run() {
			await renderer.init();
			var a = setInterval(() => {
				if (world.ball.move(direction.x, direction.y)){
					renderer.redrawMap();
				} else {
					const x = direction.x
					const width = world.ball.width
					if (world.ball.getCurPos().x + x < 0 || (world.ball.getCurPos().x + x + width) > WIDTH || world.map[world.ball.getCurPos().x + x][world.ball.getCurPos().y] !== VOID){
						direction.x = -x;
					}
					const y = direction.y
					const height = world.ball.height
					if (world.ball.getCurPos().y + y < 0 || (world.ball.getCurPos().y + y + height) > HEIGHT || world.map[world.ball.getCurPos().x][world.ball.getCurPos().y + y] !== VOID){
						direction.y = -y;
					}
					if (world.ball.move(direction.x, direction.y)){
						renderer.redrawMap();
					} else {
						direction.x = -x;
						direction.y = -y;
						if (world.ball.move(direction.x, direction.y)){
							renderer.redrawMap();
						}
					}
				}
			}, 200);
			setTimeout(() => {clearInterval(a)}, 20000);
			input.init();
		}
		function join() {
			if (world.shapes.length === 0){
				this.createWidgets(viewport.x + viewport.width, viewport.y + viewport.height);
				//await rtb.board.setViewportWithAnimation({x: viewport.x - BLOCK_SIZE, y: viewport.y - BLOCK_SIZE, width: (WIDTH + 1) * BLOCK_SIZE, height: (HEIGHT + 1) * BLOCK_SIZE})
			} else {
				mapDeepCopy(world.initialMap, world.dirtyMap);
			}
			world.pads[1].init(4, 17);
			input.init();
		}
	</script>
</body>

</html>